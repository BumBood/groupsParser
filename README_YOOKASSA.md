# Инструкция по настройке платежей через ЮKassa

## Получение платежного токена для Telegram

### Подготовка

1. Убедитесь, что у вас есть аккаунт в ЮKassa с подключенными платежами.
2. Перейдите в BotFather (@BotFather) в Telegram.
3. Выберите вашего бота или создайте нового.
4. Введите команду `/mybots`.
5. Выберите вашего бота из списка.
6. Нажмите на "Payments".
7. Выберите "ЮKassa" (Yookassa) из списка платежных систем.
8. Следуйте инструкциям для подключения ЮKassa.
9. После успешного подключения, вы получите платежный токен.

### Настройка в боте

1. Откройте файл `config/parameters.yaml`.
2. Добавьте платежный токен в параметр `yookassa_provider_token`.

Например:
```yaml
parameters:
  # Другие параметры
  yookassa_provider_token: "токен_от_BotFather"
```

## Тестирование платежей

Для тестирования платежей можно использовать тестовые карты:

- **Номер карты**: 1111 1111 1111 1026
- **Срок действия**: любой в будущем
- **CVV**: любые 3 цифры
- **Код подтверждения**: 123

## Структура платежной системы

Платежная система состоит из следующих компонентов:

1. `YooKassa` класс в `bot/yookassa.py` для работы с API
2. Обработчики платежей в `bot/payments.py`
3. Интеграция с базой данных для учета платежей и покупок тарифов

## Доступные функции

1. **Пополнение баланса**: пользователь может пополнить баланс через встроенный платеж в Telegram.
2. **Покупка тарифов**: пользователь может приобрести тариф через ЮKassa.

## Обработка платежей

Платежи обрабатываются автоматически:

1. Пользователь инициирует платеж.
2. Telegram отправляет pre_checkout_query для предварительной проверки.
3. После успешной оплаты, Telegram отправляет сообщение с данными о платеже.
4. Бот обрабатывает это сообщение и выполняет необходимые действия (пополнение баланса или активация тарифа).
